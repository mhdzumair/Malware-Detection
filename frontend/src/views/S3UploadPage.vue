<template>
  <v-container>
    <h1>Simulate Upload a File to S3</h1>
    <v-form @submit.prevent="uploadFile" class="upload-form">
      <v-file-input
        v-model="files"
        label="Choose a file..."
        prepend-icon="mdi-cloud-upload"
        accept=".exe,.dll,.zip"
        :disabled="fileUrl.length > 0"
        show-size
        color="primary"
      ></v-file-input>
      <v-text-field
        label="File URL"
        v-model="fileUrl"
        :disabled="files"
        placeholder="Enter the URL of the file"
        color="primary"
      ></v-text-field>
      <v-text-field
        label="Zip Password"
        v-model="zipPassword"
        :disabled="!isZipFile"
        placeholder="Enter the password for the zip file"
        color="primary"
      ></v-text-field>
      <v-row class="text-center">
        <v-col>
          <v-btn type="submit" color="primary" class="mr-2">Upload to S3</v-btn>
          <v-btn color="grey" @click="resetForm">Reset</v-btn>
        </v-col>
      </v-row>
    </v-form>
    <v-alert v-if="message" :type="messageType" class="mt-4" dense>
      {{ message }}
    </v-alert>
  </v-container>
</template>

<script>
import { uploadFileToS3 } from '@/services/apiService';

export default {
  name: 'S3UploadPage',
  data() {
    return {
      files: null,
      fileUrl: '',
      zipPassword: '',
      message: '',
      messageType: 'success'
    };
  },
  computed: {
    isZipFile() {
      if (this.files && this.files.length > 0) {
        return this.files[0].name.endsWith('.zip');
      } else if (this.fileUrl) {
        return this.fileUrl.endsWith('.zip');
      }
      return false;
    }
  },
  methods: {
    async uploadFile() {
      if (!this.files && !this.fileUrl) {
        this.message = 'Please select a file or enter a file URL.';
        this.messageType = 'error';
        return;
      }
      try {
        const response = await uploadFileToS3(this.files ? this.files[0] : null, this.fileUrl, this.zipPassword);
        this.message = response.message;
        this.messageType = 'success';
      } catch (error) {
        this.message = 'Error uploading file to S3.';
        this.messageType = 'error';
      }
    },
    resetForm() {
      this.files = null;
      this.fileUrl = '';
      this.zipPassword = '';
    }
  }
};
</script>

<style>
/* Add any specific styles for your upload form */
</style>
