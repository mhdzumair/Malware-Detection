<template>
  <v-container class="fill-height">
    <!-- Aligns everything to the center -->
    <v-row justify="center" align="center">
      <v-col cols="12" sm="8" md="6" lg="4">
        <!-- Card max-width is managed by the grid, removed mx-auto my-auto -->
        <v-card outlined>
          <v-card-title class="justify-center blue darken-2 white--text py-4">
            <!-- Title centered by justify-center -->
            <h3>Login to your account</h3>
          </v-card-title>
          <v-card-text>
            <v-form ref="form" @submit.prevent="handleLogin" v-model="valid">
              <v-text-field
                label="Username"
                prepend-icon="mdi-account"
                v-model="username"
                :rules="[v => !!v || 'Username is required']"
                outlined
                required
              ></v-text-field>
              <v-text-field
                label="Password"
                prepend-icon="mdi-lock"
                v-model="password"
                :rules="[v => !!v || 'Password is required']"
                type="password"
                outlined
                required
              ></v-text-field>
              <v-alert v-if="errorMessage" type="error" class="mt-4">
                {{ errorMessage }}
              </v-alert>
              <v-btn
                :disabled="!valid"
                type="submit"
                color="indigo darken-1"
                class="white--text"
                large
                block
                :loading="loading"
              >
                Login
              </v-btn>
            </v-form>
          </v-card-text>
        </v-card>
      </v-col>
    </v-row>
  </v-container>
</template>



<script>
import {login} from '@/services/apiService';

export default {
  name: 'LoginPage',
  data() {
    return {
      username: '',
      password: '',
      valid: false,
      loading: false,
      errorMessage: ''
    };
  },
  methods: {
    async handleLogin() {
      if (this.valid) {
        this.loading = true;
        this.errorMessage = '';

        try {
          const response = await login(this.username, this.password);
          localStorage.setItem('token', response.access_token);
          this.$router.push('/');
        } catch (error) {
          this.errorMessage = 'Login failed. Please check your credentials.';
        } finally {
          this.loading = false;
        }
      }
    }
  }
};
</script>
