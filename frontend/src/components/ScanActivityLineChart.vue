<template>
  <v-card>
    <v-card-title>Scan Activity Over Time</v-card-title>
    <v-card-text>
      <!-- Only render the LineChart if chartData is loaded -->
      <line-chart v-if="loaded" :data="chartData" :options="chartOptions"/>
      <!-- Display a loading text or spinner here if not loaded -->
      <div v-else>Loading...</div>
    </v-card-text>
  </v-card>
</template>

<script>
import {Line} from 'vue-chartjs';
import {onMounted, ref, watchEffect} from 'vue';
import Chart from 'chart.js/auto';

export default {
  name: 'ScanActivityLineChart',
  components: {
    LineChart: Line,
  },
  props: {
    chartData: {
      type: Object,
      required: false // Initially the data is not required
    },
    chartOptions: {
      type: Object,
      default: () => ({responsive: true, maintainAspectRatio: false, })
    }
  },
  setup(props) {
    const chartRef = ref(null);
    const loaded = ref(false); // Indicates if the chart data is loaded

    onMounted(() => {
      if (props.chartData) {
        loaded.value = true; // Set loaded to true if chartData is passed in
      }
    });

    watchEffect(() => {
      if (chartRef.value && loaded.value) {
        const ctx = chartRef.value.getContext('2d');
        new Chart(ctx, {
          type: 'line',
          data: props.chartData,
          options: props.chartOptions,
        });
      }
    });

    // Re-run the watchEffect when chartData changes
    watchEffect(() => {
      if (props.chartData) {
        loaded.value = true;
      }
    });

    return {chartRef, loaded};
  },
};
</script>
