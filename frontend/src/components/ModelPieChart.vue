<template>
  <v-card>
    <v-card-title>{{ title }}</v-card-title>
    <v-card-text>
      <pie-chart :data="chartData" :options="chartOptions"/>
    </v-card-text>
  </v-card>
</template>

<script>
import {Pie} from 'vue-chartjs';
import {nextTick, onMounted, ref, watch} from 'vue';
import Chart from 'chart.js/auto';

export default {
  name: 'ModelPieChart',
  components: {
    PieChart: Pie,
  },
  props: {
    title: String,
    chartData: Object,
    chartOptions: {
      type: Object,
      default: () => ({responsive: true, maintainAspectRatio: false})
    }
  },
  setup(props) {
    const chartRef = ref(null);
    let chartInstance = null;

    onMounted(async () => {
      await nextTick(); // Wait for the DOM to be ready
      if (chartRef.value) { // Check if chartRef.value is not null
        const ctx = chartRef.value.getContext('2d'); // Get the context from the canvas element
        chartInstance = new Chart(ctx, {
          type: 'pie',
          data: props.chartData,
          options: props.chartOptions,
        });
      }
    });

    watch(() => props.chartData, (newData) => {
      if (newData && chartInstance) {
        chartInstance.data = newData;
        chartInstance.update();
      }
    }, {immediate: true});

    return {chartRef};
  },
};
</script>
